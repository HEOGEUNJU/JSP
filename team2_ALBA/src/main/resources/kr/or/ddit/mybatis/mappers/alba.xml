<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.alba.dao.AlbaDAO">
<sql id="searchFrag">
	<where>
		<if test="simpleCondition neq null and @org.apache.commons.lang3.StringUtils@isNotBlank(simpleCondition.searchWord)">
			<choose>
				<when test="simpleCondition.searchType eq 'name'">
					INSTR(AL_NAME, #{simpleCondition.searchWord}) >0
				</when>
				<when test="simpleCondition.searchType eq 'mail'">
					INSTR(AL_MAIL, #{simpleCondition.searchWord}) >0
				</when>
				<otherwise>
					INSTR(AL_NAME, #{simpleCondition.searchWord}) >0
					OR
					INSTR(AL_MAIL, #{simpleCondition.searchWord}) >0
				</otherwise>
			</choose>				
		</if>
	</where>
</sql>	
	
	<select id="selectTotalRecord" parameterType="PagingVO" resultType="int">
	SELECT COUNT(*)
	FROM ALBA
    <include refid="searchFrag" />
	</select>
	
	<select id="selectAlbaList" parameterType="PagingVO" resultType="kr.or.ddit.alba.vo.AlbaVO">
	SELECT B.*
	FROM
	(
		SELECT A.*, ROWNUM RNUM
		FROM(
			SELECT
				AL_ID,
				AL_NAME,
				AL_AGE,
				AL_ZIP,
				AL_ADDR1,
				AL_ADDR2,
				AL_HP,
				GR_CODE,
				AL_GEN,
				AL_MAIL,
				AL_CAREER,
				AL_SPEC,
				AL_DESC,
				AL_IMG
			FROM ALBA
      		<include refid="searchFrag" />
			ORDER BY ROWID DESC    
		)A
	)B
	WHERE RNUM BETWEEN #{startRow} AND #{endRow}
	</select>
</mapper>